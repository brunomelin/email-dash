#!/bin/bash
# Verificaรงรฃo Rรกpida do Cron

echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "๐ VERIFICAรรO RรPIDA DO CRON"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo ""

# 1. Verificar se crontab ainda estรก configurado
echo "1๏ธโฃ  Crontab atual:"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
crontab -l 2>/dev/null | grep auto-sync
if [ $? -ne 0 ]; then
    echo "โ CRON NรO ESTร CONFIGURADO!"
else
    echo "โ Cron encontrado"
fi
echo ""

# 2. Verificar รบltimas linhas do log
echo "2๏ธโฃ  รltimas 50 linhas do log:"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
if [ -f ~/logs/auto-sync.log ]; then
    tail -50 ~/logs/auto-sync.log
    echo ""
    echo "รltima modificaรงรฃo do arquivo:"
    ls -lh ~/logs/auto-sync.log | awk '{print $6, $7, $8}'
else
    echo "โ Log nรฃo existe: ~/logs/auto-sync.log"
fi
echo ""

# 3. Verificar รบltimas execuรงรตes do cron no sistema
echo "3๏ธโฃ  รltimas execuรงรตes do cron (รบltimas 20):"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
sudo grep "auto-sync" /var/log/syslog 2>/dev/null | tail -20 || echo "Nenhuma execuรงรฃo encontrada"
echo ""

# 4. Verificar serviรงo cron
echo "4๏ธโฃ  Status do serviรงo cron:"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
sudo systemctl is-active cron && echo "โ Cron estรก ATIVO" || echo "โ Cron estรก INATIVO"
echo ""

# 5. Teste manual
echo "5๏ธโฃ  Testando execuรงรฃo manual:"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
cd ~/apps/email-dash
echo "Diretรณrio: $(pwd)"
echo "Iniciando teste..."
timeout 30s npx tsx auto-sync.js 2>&1 | head -30
echo ""

echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"

